<p align="center" >
  <img src="https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/assets/66541860/0fbed41e-1b2b-44f4-9562-6eb7aeeb2c7c" width="256" height="256" alt="NJS"></a>
</p>
<h1 align="center">Semi-Auto-NovelAI-to-Pixiv</h1>
<h4 align="center">‚ú®Generate Images with NovelAI and Upload to Pixiv‚ú®</h4>

<p align="center">
    <img src="https://img.shields.io/badge/Python-3.10+-blue">
    <a href="https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/raw/main/LICENSE"><img src="https://img.shields.io/github/license/zhulinyv/Semi-Auto-NovelAI-to-Pixiv" alt="license"></a>
    <img src="https://img.shields.io/github/issues/zhulinyv/Semi-Auto-NovelAI-to-Pixiv">
    <img src="https://img.shields.io/github/stars/zhulinyv/Semi-Auto-NovelAI-to-Pixiv">
    <img src="https://img.shields.io/github/forks/zhulinyv/Semi-Auto-NovelAI-to-Pixiv">
</p>

## üí¨ Introduction

**Translated by ChatGPT**

‚ú® **Currently implemented functions**:

| Function | Description | Example | Explanation |
|:---:|---|---|---|
| Tutorial | Introduction and usage tutorial for this project | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/15.png?raw=true) | Please read carefully |
| Text-to-Image | A user interface for NovelAI written using Gradio, functionally identical to the NovelAI website except for the interface | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/1.png?raw=true) | Generated images will be saved in the `./output/t2i` folder |
| Random NSFW | Generates a NSFW image by randomly combining tags from `./files/favorite.json`, or infinitely generates NSFW images | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/3.png?raw=true) | For configuration of random NSFW, refer to the section on random NSFW in [Other Configurations](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv#%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE) |
| Random Image | Infinitely generates images by reading `*.txt` files in `./file/prompt` and appending the entered prompts, stops when all `*.txt` files in the folder have been processed or stopped manually | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/4.png?raw=true) | For configuration of random images, refer to the section on random images in [Other Configurations](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv#%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE) |
| Image-to-Image | Functionally identical to using the NovelAI website, supports any image, additionally supports batch image-to-image generation | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/2.png?raw=true) | Generated images will be saved in the `./output/i2i` folder, but a temporary image named `temp.png` will be generated in the `./output` folder, which can be deleted. For batch processing, place images in the same folder, e.g., `./output/choose_to_i2i` |
| Local Redraw | Supports images generated by NovelAI only, requires uploading a mask, supports batch operations | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/5.png?raw=true) | Uploaded mask should have white areas for redrawing and transparent areas for retaining original, resolution should match the image to redraw. For batch operations, place images and masks in separate folders, ensuring filenames match, e.g., `./output/inpaint/img`, `./output/inpaint/mask`, generated images will be saved in `./output/inpaint` |
| Vibe | Functionally identical to using the NovelAI website, with added batch functionality | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/16.png?raw=true) | Prepare images in the same folder, rename them in the format `(any_name_without_underscores)_(information_extracted, float(0, 1))_(strength, float(0, 1)).png)`, e.g., `hoshino-hinata_1.0_0.6`, when the random NSFW option is checked, infinite generation will follow the pattern of random NSFW images. When unchecked, infinite generation will follow the pattern of random images |
| Super-Resolution Denoising | Applies super-resolution denoising to images using open-source projects listed in the [Acknowledgments](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv#-%E9%B8%A3%E8%B0%A2), supports single or batch processing | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/6.png?raw=true) | Generated images will be saved in the `./output/upscale` folder. Avoid using **srmd-cuda** due to instability. When using **waifu2x-caffe** or **waifu2x-converter**, a temporary batch file named `temp.bat` will be generated in the `./output` folder, which can be deleted. For batch processing, place images in the same folder, e.g., `./output/choose_to_upscale` |
| Auto Mosaic | Automatically detects key areas in images and applies mosaic, may not detect 100% accurately, supports batch processing | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/7.png?raw=true) | Generated images will be saved in the `./output/mosaic` folder. For batch processing, place images in the same folder, e.g., `./output/choose_to_mosaic` |
| Add Watermark | Adds a random watermark with specified opacity to random positions (top-left, top-right, bottom-left, bottom-right) of images | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/8.png?raw=true) | Prepare your own watermarks in the `./files/water` folder. Enter the directory of images to process, processed images will be saved in `./output/water` |
| Upload to Pixiv | Batch uploads images to Pixiv | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/9.png?raw=true) | For Pixiv upload configuration, refer to the section on Pixiv upload in [Other Configurations](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv#%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE) |
| Image Filtering | Tool for manually filtering images | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/10.png?raw=true) | Enter the image directory and output directory. A file named `array_data.npy` will be generated in the `./output` folder, saving progress for later sessions. |
| Data Erasure | Batch erases, restores, or exports image generation information | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/11.png?raw=true) | For restoration, prepare *.png images with prompts or *.txt files containing prompts, filenames in the selected restoration directory must match those in the prompt information directory |
| Magic Parser | Reads PNG info using open-source projects listed in the [Acknowledgments](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv#-%E9%B8%A3%E8%B0%A2) | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/12.png?raw=true) | Nested into this project via iframe |
| GPT Free | Free, multi-model GPT using open-source projects listed in the [Acknowledgments](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv#-%E9%B8%A3%E8%B0%A2) | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/13.png?raw=true) | Nested into this project via iframe |
| Configuration Settings | Change configuration items in the WebUI | ![image](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/blob/main/files/imgs/14.png?raw=true) | Remember to save changes, changes take effect immediately after restart |

Learning Gradio, trying to create a WebUI for this project.

## üíª Configuration Requirements

| Item | Description |
|:---:|:---:|
| NovelAI Membership | To generate images infinitely, it is recommended to have a $25/month membership. |
| Magic Network | To successfully send POST requests, Magic Network is required. |
| 1GB VRAM | At least 1GB of VRAM is required to use all engines for super-resolution denoising. |
| 2GB RAM | At least 2GB of RAM is required for smooth operation of this project. |
| Windows 10/11(x64) | To use all features, a 64-bit version of Windows 10/11 is required. |
| [Microsoft Visual C++ 2015](https://www.microsoft.com/en-us/download/details.aspx?id=53587) | Installation of the runtime library is required to use all engines for super-resolution denoising. |

## üíø Deployment

### 1Ô∏è‚É£ Install Python

Suggested to install [Python 3.10.11](https://www.python.org/ftp/python/3.10.11/python-3.10.11-amd64.exe), During installation, please check **Add Python to PATH** and keep the rest as default.

### 2Ô∏è‚É£ Install Git

Suggested to install [Latest Version](https://git-scm.com/download/win), you just need to click **Next** button.

### 3Ô∏è‚É£ Clone Repositories

Open cmd/powershell, run `git clone -b main --depth=1 https://github.com/zhulinyv/NJS.git`

### 4Ô∏è‚É£ Next step

Now you can launch the `run.bat` at the origin directory to start WebUI, it will create the virtual environment and install the dependences at the first time, it will take a long time, so you can drink some coffe or read the documents below

## ‚öôÔ∏è Configuration

‚ö†Ô∏è 1. If you have started the WebUI but haven't performed necessary configurations, please navigate to the settings page for necessary configurations.

‚ö†Ô∏è 2. Please do not skip this step, it's crucial. Make sure you have reviewed all configurations thoroughly.

‚ö†Ô∏è 3. Alternatively, you can directly edit the `.env` file for configurations.

‚ö†Ô∏è Getting the token:

- ![jc](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/assets/66541860/82f657fe-81bc-412b-a63c-11a878fde7d2)

‚ö†Ô∏è Getting pixiv_cookie and pixiv_token:

- 1. Open https://www.pixiv.net/illustration/create and manually upload an image.
- 2. Choose tags, age restrictions, AI-generated work, public range, comments on works, and original works.
- 3. Press F12 to open the console and switch to the Network tab.
- 4. Click on the submit button.
- 5. Find and click on the 'illustraion' request, then switch to the Headers tab.
- 6. In the request headers, you can find the Cookie and X-Csrf-Token.
- ![97ae3696ad11708ae2eb0474f198de0c](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/assets/66541860/e59caaf6-c69d-485e-965d-d7d924397667)

## üéâ Use

**Running `run.bat` will automatically open the default browser and navigate to [127.0.0.1:11451](http://127.0.0.1:11451).**

For legacy users: It's no longer recommended to run individual scripts; please use the WebUI instead.

If necessary, please **refer to the source code** and create a `*.py` file in the root directory, importing functions from the corresponding sections of the source code, for example:

```python
from src.t2i import t2i

t2i(True) # True indicates infinite generation
```

If you want to deploy your own plugins, please turn to [Wiki](https://github.com/zhulinyv/Semi-Auto-NovelAI-to-Pixiv/wiki/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91)

## üìñ To-Do

+ [x] Batch text-to-image generation
+ [x] Batch image-to-image generation
+ [x] Batch upload to Pixiv
+ [x] Calculate remaining crystals
+ [x] Batch [waifu2x](https://github.com/nagadomi/waifu2x)
+ [x] Batch local redraw
+ [x] ~~Batch vibe~~
+ [x] Batch mosaic
+ [x] Write a WebUI using Gradio
+ [ ] ~~Containerize the project for persistent running~~
+ [x] Change the style of the interface
+ [x] ~~Add ChatGPT~~
+ [x] ~~White a picture selector~~
+ [ ] ~~Get token by account and password~~
+ [x] Add more upscale engine
+ [x] Add more ways to t2i
+ [x] Batch watermarking
+ [x] Batch PNG info processing
+ [x] Configuration item interface
+ [x] Open related folders functionality
+ [x] Merge interfaces such as random NSFW
+ [ ] Hotkey for quick image filtering
+ [x] Tutorial and instruction pages
+ [x] Custom plugins
+ [ ] ...

## ü§ù Acknowledgements

This project uses [waifu2x-ncnn-vulkan](https://github.com/nihui/waifu2x-ncnn-vulkan) | [Anime4KCPP](https://github.com/TianZerL/Anime4KCPP) | [realcugan-ncnn-vulkan](https://github.com/nihui/realcugan-ncnn-vulkan/) | [realesrgan-ncnn-vulkan](https://github.com/xinntao/Real-ESRGAN-ncnn-vulkan) | [realsr-ncnn-vulkan](https://github.com/nihui/realsr-ncnn-vulkan/) | [srmd-cuda](https://github.com/MrZihan/Super-resolution-SR-CUDA) | [srmd-ncnn-vulkan](https://github.com/nihui/srmd-ncnn-vulkan) | [waifu2x-caffe](https://github.com/lltcggie/waifu2x-caffe) | [waifu2x-converter](https://github.com/DeadSix27/waifu2x-converter-cpp) for denoising and upscaling images.

This project uses [stable-diffusion-inspector](https://spell.novelai.dev/) for parsing image metadata.

This project uses [Genshin-Sync](https://huggingface.co/spaces/AppleHarem/Genshin-Sync/tree/main) for uploading images to Pixiv.

This project uses [GPT4FREE](https://github.com/xtekky/gpt4free) to provide GPT services.

This project uses  [novelai-image-metadata](https://github.com/NovelAI/novelai-image-metadata) to eraser the metadata.


<hr>
<img width="300px" src="https://count.getloli.com/get/@zhulinyv?theme=rule34"></img>
